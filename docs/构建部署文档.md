# LitePortal 打包说明

> 本文档详细说明了 LitePortal 项目的打包流程和相关脚本的使用方法。

## 一、二进制文件构建

通过以下步骤，可以生成 **Windows**、**MacOS**、**Linux** 二进制可执行文件。

### 1.1、构建步骤

1. 创建生成目录`/dist`、`/dist/web`、`/dist/executable`；
2. 生成前端生产文件→复制`/frontend/dist/*`到`/dist/web/*`；
3. 生成后端生产文件→复制`/backend/dist/*`到`/dist/*`；
4. 复制其他必要文件：复制`package.json`、`pnpm-lock.yaml`、`.env.production`到`/dist/*`；
5. `pkg`配置、打包。

### 1.2、脚本命令运行顺序

在开发、构建和部署 LitePortal 项目时，建议按照以下顺序执行相关脚本命令：

1. **构建前清理**（可选）：
   - windows 执行 `clean.bat` 清理之前的构建文件和临时文件
   - 或者`node clean.build.js`

2. **构建项目**：
   - 提交github master 分支自动构建，使用 Github Action；
   - 脚本路径：`.github\workflows\pkg.yml`；
   - `build.exe.js(废弃)`是原始打包脚本，打包逻辑相同。

3. **测试构建结果**：
   - 在 `dist/executable` 目录下执行 `start.bat`（Windows）或 `start.sh`（Linux/Mac）；
   - 确认应用能够正常启动和运行。

4. **Docker 构建**（可选）：
   - 待补充

### 1.3、目录结构

构建完成后，`dist` 目录将包含以下内容：

```
dist/
├── executable/    	# 打包后的可执行文件
│   └── server     	# 后端可执行文件
├── start.bat       # Windows 启动脚本
├── start.sh        # Linux/Mac 启动脚本
└── README.md       # 部署说明文档
```

## 二、部署说明

### 2.1、本地部署

- 在 Windows 上双击运行 `dist/start.bat`，或者直接运行`.exe`；
- 在 Linux/Mac 上运行 `./dist/start.sh`，或者直接运行`server`；

### 2.2、Docker 部署

待补充



## 注意事项

1. **构建环境要求**：
   - 需要安装 Node.js (推荐版本 22.x)
   - Windows 系统需要确保批处理文件可以正常执行

2. **运行环境要求**：
   - 本地部署：无需安装 Node.js（后端已打包为可执行文件）
   - Docker 部署：需要安装 Docker

3. **配置**：
   - 后端配置文件位于 `/backen/.env.production`，可根据需要修改；
   - 默认端口为 8080，可通过`.env.production`环境变量 `PORT`修改。

4. **数据存储**：
   - 首次运行会自动创建数据库文件；
   - 数据存储在 `./data` 目录下。

5. **多平台支持**：
   - 后端可执行文件支持 Windows、Linux 和 macOS 三种主流操作系统
   - Docker 镜像基于 Alpine Linux，适用于大多数 Linux 环境

## 常见问题

1. **中文显示乱码**：
   - 确保系统控制台使用 UTF-8 编码
   - 脚本已添加 `chcp 65001` 命令以支持中文显示

2. **构建失败**：
   - 检查 Node.js 是否正确安装
   - 确保网络连接正常，能够下载依赖包
   - 查看错误日志，根据具体错误信息进行排查

3. **启动失败**：
   - 检查端口 8080 是否被占用
   - 确保可执行文件具有执行权限（Linux/Mac）
   - 查看日志文件，了解具体错误信息
