# LitePortal 打包说明

本文档详细说明了 LitePortal 项目的打包流程和相关脚本的使用方法。

## 脚本命令运行顺序

在开发、构建和部署 LitePortal 项目时，建议按照以下顺序执行相关脚本命令：

1. **开发阶段**：
   - 前端开发：在 `frontend` 目录下运行 `npm run dev`
   - 后端开发：在 `backen` 目录下运行 `npm run dev`

2. **构建前清理**（可选）：
   - 执行 `clean.bat` 清理之前的构建文件和临时文件
   - 系统会询问是否同时清理 node_modules 文件，根据需要选择

3. **构建项目**：
   - 执行 `build.bat` 或 `node build.js` 进行完整构建
   - 构建过程包括前端构建、后端打包和创建启动脚本

4. **测试构建结果**：
   - 在 `dist` 目录下执行 `start.bat`（Windows）或 `start.sh`（Linux/Mac）
   - 确认应用能够正常启动和运行

5. **Docker 构建**（可选）：
   - 执行 `docker build -t liteportal .` 构建 Docker 镜像
   - 执行 `docker run -p 8080:8080 liteportal` 运行容器

## 目录结构

```
LitePortal/
├── build.js          # Node.js 构建脚本
├── build.bat         # Windows 批处理构建脚本
├── clean.bat         # Windows 批处理清理脚本
├── Dockerfile        # Docker 构建文件
├── frontend/         # 前端源代码
├── backen/           # 后端源代码
└── dist/             # 构建输出目录（构建后生成）
```

## 构建脚本

### build.js

这是主要的构建脚本，使用 Node.js 编写，执行完整的构建过程：

1. 清理输出目录
2. 构建前端项目
3. 准备后端文件并打包成可执行文件
4. 创建启动脚本
5. 创建 README 文件

**使用方法**：
```bash
node build.js
```

### build.bat

这是 Windows 批处理脚本，用于简化构建过程：

1. 检查 Node.js 是否已安装
2. 运行 build.js 脚本
3. 显示构建结果

**使用方法**：
```
双击运行 build.bat 文件
```

## 清理脚本

### clean.bat

这是 Windows 批处理脚本，用于清理构建文件和临时文件：

1. 清理前端构建文件 (frontend/dist)
2. 清理后端构建文件 (backen/dist)
3. 清理项目构建输出 (dist)
4. 清理 stats.html 文件
5. 可选择是否清理 node_modules 文件

**使用方法**：
```
双击运行 clean.bat 文件
```

## 构建输出

构建完成后，`dist` 目录将包含以下内容：

```
dist/
├── backen/
│   ├── executable/    # 打包后的可执行文件
│   │   └── server     # 后端可执行文件
│   ├── config.js      # 配置文件
│   ├── data/          # 数据存储目录
│   └── ...            # 其他后端文件
├── web/               # 前端构建文件
│   ├── assets/        # 前端资源文件
│   ├── index.html     # 前端入口文件
│   └── ...            # 其他前端文件
├── start.bat          # Windows 启动脚本
├── start.sh           # Linux/Mac 启动脚本
└── README.md          # 部署说明文档
```

## 部署说明

### 本地部署

1. **构建项目**：
   - 在 Windows 上双击运行 `build.bat`
   - 或在命令行中运行 `node build.js`

2. **运行应用**：
   - 在 Windows 上双击运行 `dist/start.bat`
   - 在 Linux/Mac 上运行 `./dist/start.sh`

### Docker 部署

1. **构建 Docker 镜像**：
   ```bash
   docker build -t liteportal .
   ```

2. **运行 Docker 容器**：
   ```bash
   docker run -p 8080:8080 liteportal
   ```

## 注意事项

1. **构建环境要求**：
   - 需要安装 Node.js (推荐版本 22.x)
   - Windows 系统需要确保批处理文件可以正常执行

2. **运行环境要求**：
   - 本地部署：无需安装 Node.js（后端已打包为可执行文件）
   - Docker 部署：需要安装 Docker

3. **配置**：
   - 后端配置文件位于 `dist/backen/config.js`，可根据需要修改
   - 默认端口为 8080，可通过环境变量 PORT 修改

4. **数据存储**：
   - 首次运行会自动创建数据库文件
   - 数据存储在 `dist/backen/data` 目录下

5. **多平台支持**：
   - 后端可执行文件支持 Windows、Linux 和 macOS 三种主流操作系统
   - Docker 镜像基于 Alpine Linux，适用于大多数 Linux 环境

## 常见问题

1. **中文显示乱码**：
   - 确保系统控制台使用 UTF-8 编码
   - 脚本已添加 `chcp 65001` 命令以支持中文显示

2. **构建失败**：
   - 检查 Node.js 是否正确安装
   - 确保网络连接正常，能够下载依赖包
   - 查看错误日志，根据具体错误信息进行排查

3. **启动失败**：
   - 检查端口 8080 是否被占用
   - 确保可执行文件具有执行权限（Linux/Mac）
   - 查看日志文件，了解具体错误信息

## 更新日志

- v1.0.0：初始版本，支持前端构建和后端打包
- 添加了 Docker 支持
- 修复了中文显示问题
- 添加了清理脚本
